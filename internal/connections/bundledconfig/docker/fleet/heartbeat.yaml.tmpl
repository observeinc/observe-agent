  receivers:
    heartbeat:
      interval: 10s
      environment: docker
      auth_check:
        url: ${env:OBSERVE_COLLECTOR_URL}
        headers:
          authorization: ${env:OBSERVE_AUTHORIZATION_HEADER}
  processors:
    k8sattributes/heartbeat:
      extract:
        otel_annotations: true
        metadata:
          - k8s.namespace.name
          - k8s.node.name
          - k8s.pod.name
          - k8s.container.name
          - service.name
        labels:
          # Extract app.kubernetes.io/* labels from the pod as the full tag.
          - tag_name: $1
            key_regex: (app\.kubernetes\.io/.+)
            from: pod
      passthrough: false
      pod_association:
      - sources:
        - from: resource_attribute
          name: k8s.pod.ip
      - sources:
        - from: resource_attribute
          name: k8s.pod.uid
      - sources:
        - from: connection
    resource/heartbeat:
      attributes:
      - key: observe.agent.hostname
        from_attribute: host.name
        action: insert
      - key: observe.agent.podName
        from_attribute: k8s.pod.name
        action: insert
  exporters:
    debug:
      verbosity: detailed
      sampling_initial: 5
      sampling_thereafter: 200
    otlphttp/agentheartbeat:
        compression: zstd
        logs_endpoint: ${env:OBSERVE_COLLECTOR_URL}/v1/kubernetes/v1/entity
        headers:
            authorization: ${env:OBSERVE_AUTHORIZATION_HEADER}
            x-observe-target-package: Observe Agent
        retry_on_failure:
            enabled: true
        sending_queue:
            num_consumers: 4
            queue_size: 100
  service:
    pipelines:
      logs/heartbeat:
        receivers: [heartbeat]
        processors: [k8sattributes/heartbeat, resourcedetection, resource/heartbeat]
        exporters: [otlphttp/agentheartbeat, debug]
